---
import { Image } from "astro:assets";
import { getCollection } from "astro:content";
import BaseHead from "../../components/BaseHead.astro";
import Footer from "../../components/Footer.astro";
import Header from "../../components/Header.astro";
import { SITE_TITLE } from "../../consts";

const items = (await getCollection("products")).sort((a, b) => {
  const ad = a.data.pubDate?.valueOf() ?? 0;
  const bd = b.data.pubDate?.valueOf() ?? 0;
  return bd - ad;
});

const pageTitle = `${SITE_TITLE} / Products`;
---

<!doctype html>
<html lang="ja">
  <head>
    <BaseHead title={pageTitle} description="Works / Products" />
    <style>
      main { width: min(960px, 92vw); }
      .hero { margin: 1.5rem 0 1rem; }
      .hero h1 { margin: 0 0 .25rem; line-height: 1.1; }
      .hero p { margin: 0; color: rgb(var(--gray)); }

      .grid {
        display: grid;
        grid-template-columns: repeat(12, 1fr);
        gap: 1rem;
        padding: 0;
        margin: 1rem 0 0;
        list-style: none;
      }

      .card {
        grid-column: span 6;
        border-radius: 16px;
        overflow: hidden;
        background: rgba(255,255,255,.02);
        border: 1px solid rgba(255,255,255,.06);
        box-shadow: none;
        transition: 0.2s ease;
      }

      .card a {
        display: block;
        color: inherit;
        text-decoration: none;
      }

      .thumb {
        width: 100%;
        height: 200px; /* 固定の高さ */
        display: flex;
        justify-content: center;
        align-items: center;
        overflow: hidden;
        background-color: black; /* 余白を黒にする */
      }

      .thumb img {
        width: 100%;
        height: 100%;
        object-fit: contain; /* 画像をアスペクト比を保ったままコンテナにフィットさせる */
      }

      .meta { padding: .85rem .95rem 1rem; }
      .kicker {
        font-size: .78rem;
        letter-spacing: .02em;
        color: rgb(var(--gray));
        text-transform: uppercase;
        margin: 0 0 .25rem;
      }
      .title { margin: 0 0 .4rem; line-height: 1.2; }
      .summary { margin: 0; color: rgb(var(--gray)); }

      .tags {
        display: flex;
        flex-wrap: wrap;
        gap: .35rem;
        margin: .7rem 0 0;
        padding: 0;
        list-style: none;
      }
      .tag {
        font-size: .75rem;
        padding: .15rem .5rem;
        border-radius: 999px;
        border: 1px solid rgba(255,255,255,.08);
        color: rgb(var(--gray));
      }

      .card:hover { transform: translateY(-2px); box-shadow: var(--box-shadow); }
      .card:hover .title { color: rgb(var(--accent)); }

      @media (max-width: 720px) {
        .card { grid-column: span 12; }
      }
    </style>
  </head>
  <body>
    <Header />
    <main>
      <section class="hero">
        <h1>Products</h1>
        <p>作ったもの／作っているもの。バナーでざっと眺める。</p>
      </section>

      <ul class="grid">
        {
          items.map((item) => {
            const href = item.data.url ?? `/my-astro-blog/products/${item.slug}/`;
            return (
              <li class="card">
                <a href={href}>
                  <div class="thumb">
                    <Image
                      src={item.data.banner}
                      alt={item.data.title}
                      widths={[640, 960, 1280]}
                      sizes="(max-width: 720px) 92vw, 460px"
                      loading="lazy"
                    />
                  </div>
                  <div class="meta">
                    <p class="kicker">{item.data.kind}</p>
                    <h3 class="title">{item.data.title}</h3>
                    {item.data.summary ? <p class="summary">{item.data.summary}</p> : null}
                    {item.data.tags?.length ? (
                      <ul class="tags">
                        {item.data.tags.slice(0, 6).map((t) => (
                          <li class="tag">{t}</li>
                        ))}
                      </ul>
                    ) : null}
                  </div>
                </a>
              </li>
            );
          })
        }
      </ul>
    </main>
    <Footer />
  </body>
</html>
